document.addEventListener('DOMContentLoaded', () => {
    const phoneInput = document.getElementById('phone-input');
    const searchButton = document.getElementById('search-button');
    const testNumberDiv = document.getElementById('test-number');
    const rxCodeInput = document.getElementById('rx-code');
    const txCodeInput = document.getElementById('tx-code');
    const copyRxButton = document.getElementById('copy-rx');
    const copyTxButton = document.getElementById('copy-tx');
    const goButton = document.getElementById('go-button');
    const messageDiv = document.getElementById('message');

    const database = {
        '010-4760-8588': 'TEST1',
        '010-9059-0355': 'TEST2',
        '010-3702-1720': 'TEST3',
        '010-7524-1993': 'TEST4',
        '010-3517-0801': 'TEST5',
        '010-5667-0694': 'TEST6',
        '010-9943-6151': 'TEST7',
        '010-6402-0866': 'TEST8',
        '010-2807-6510': 'TEST9',
        '010-9343-9957': 'TEST10',
        '010-7196-2564': 'TEST11',
        '010-2776-9966': 'TEST12',
        '010-6619-5107': 'TEST13',
        '010-3205-1074': 'TEST14',
        '010-9757-4820': 'TEST15',
        '010-5503-9707': 'TEST16',
        '010-8192-7997': 'TEST17',
        '010-5625-1590': 'TEST18',
        '010-2533-7763': 'TEST19',
        '010-5260-5104': 'TEST20',
        '010-9924-7623': 'TEST21',
        '010-8795-7369': 'TEST22',
        '010-2429-3974': 'TEST23',
        '010-2805-0682': 'TEST24',
        '010-9195-5863': 'TEST25',
        '010-2398-4529': 'TEST26',
        '010-3331-2165': 'TEST27',
        '010-8446-5546': 'TEST28',
        '010-9590-3081': 'TEST29',
        '010-7929-9342': 'TEST30',
        '010-2057-6791': 'TEST31',
        '010-2645-0432': 'TEST32',
        '010-8812-4888': 'TEST33',
        '010-5162-9577': 'TEST34',
        '010-5553-6266': 'TEST35',
        '010-9073-5059': 'TEST36',
        '010-9944-2154': 'TEST37',
        '010-3928-3102': 'TEST38',
        '010-3325-9457': 'TEST39',
        '010-8799-8016': 'TEST40',
        '010-2256-6257': 'TEST41',
        '010-7115-4827': 'TEST42',
        '010-2124-8720': 'TEST43',
        '010-9647-9988': 'TEST44',
        '010-6296-8107': 'TEST45',
        '010-2888-2327': 'TEST46',
        '010-2120-4038': 'TEST47',
        '010-7743-6126': 'TEST48',
        '010-7453-0253': 'TEST49',
        '010-2077-8640': 'TEST50',
        '010-2406-9875': 'TEST51',
        '010-9376-8627': 'TEST52',
        '010-4193-0278': 'TEST53',
        '010-3313-7156': 'TEST54',
        '010-2926-8309': 'TEST55',
        '010-4128-0100': 'TEST56',
        '010-9357-7622': 'TEST57',
        '010-9473-9847': 'TEST58',
        '010-6404-6407': 'TEST59',
        '010-3092-0015': 'TEST60',
        '010-4516-7579': 'TEST61',
        '010-7767-8530': 'TEST62',
        '010-7162-6788': 'TEST63',
        '010-7162-6799': 'TEST64',
        '010-2962-5171': 'TEST65',
        '010-3022-2444': 'TEST66',
        '010-7426-7892': 'TEST67',
        '010-7509-6433': 'TEST68',
        '010-9445-9024': 'TEST69',
        '010-3300-0219': 'TEST70',
        '010-9040-3173': 'TEST71',
        '010-8936-4471': 'TEST72',
        '010-7184-4463': 'TEST73',
        '010-4783-6590': 'TEST74',
        '010-9388-7906': 'TEST75',
        '010-8666-2891': 'TEST76',
        '010-9316-4972': 'TEST77',
        '010-2688-0326': 'TEST78',
        '010-5175-1979': 'TEST79',
        '010-6785-3545': 'TEST80',
        '010-3737-4939': 'TEST81',
        '010-6695-7775': 'TEST82',
        '010-3474-7979': 'TEST83',
        '010-5100-1558': 'TEST84',
        '010-4717-7062': 'TEST85',
        '010-9482-5224': 'TEST86',
        '010-5841-9295': 'TEST87',
        '010-5795-3124': 'TEST88',
        '010-3019-3541': 'TEST89',
        '010-6460-2593': 'TEST90',
        '010-3205-2035': 'TEST91',
        '010-4718-7731': 'TEST92',
        '010-2625-5496': 'TEST93',
        '010-8431-1257': 'TEST94',
        '010-3111-7353': 'TEST95',
        '010-3324-0176': 'TEST96',
        '010-7797-8529': 'TEST97',
        '010-2209-3192': 'TEST98',
        '010-8598-7480': 'TEST99',
        '010-2209-3192': 'TEST100',
        '010-9774-1912': 'TEST101',
        '010-4718-3881': 'TEST102',
        '010-4282-5115': 'TEST103',
        '010-3495-8426': 'TEST104',
        '010-7401-7008': 'TEST105',
        '010-9145-9807': 'TEST106',
        '010-3759-2283': 'TEST107',
        '010-6324-7361': 'TEST108',
        '010-5525-0578': 'TEST109',
        '010-5093-9793': 'TEST110',
        '010-2033-3393': 'TEST111',
        '010-3255-2657': 'TEST112',
        '010-2795-0515': 'TEST113',
        '010-9986-3386': 'TEST114',
        '010-8503-4260': 'TEST115',
        '010-4570-7694': 'TEST116',
        '010-7135-7344': 'TEST117',
        '010-4994-8819': 'TEST118',
        '010-9362-1091': 'TEST119',
        '010-5062-6622': 'TEST120',
        '010-9801-6377': 'TEST121',
        '010-4204-3533': 'TEST122',
        '010-2879-3662': 'TEST123',
        '010-9236-9289': 'TEST124',
        '010-7104-3337': 'TEST125',
        '010-7564-5573': 'TEST126',
        '010-9550-9501': 'TEST127',
        '010-5516-2700': 'TEST128',
        '010-4922-9062': 'TEST129',
        '010-3054-7299': 'TEST130',
        '010-2565-1120': 'TEST131',
        '010-6674-0414': 'TEST132',
        '010-5147-0318': 'TEST133',
        '010-4976-2032': 'TEST134',
        '010-3313-6622': 'TEST135',
        '010-2997-4474': 'TEST136',
        '010-4945-7692': 'TEST137',
        '010-3123-8105': 'TEST138',
        '010-3030-4577': 'TEST139',
        '010-8611-4320': 'TEST140',
        '010-4907-3033': 'TEST141',
        '010-9421-0411': 'TEST142',
        '010-8232-2153': 'TEST143',
        '010-7336-7686': 'TEST144',
        '010-2851-3741': 'TEST145',
        '010-4628-3203': 'TEST146',
        '010-2694-5070': 'TEST147',
        '010-2967-1830': 'TEST148',
        '010-9289-1582': 'TEST149',
        '010-8241-5237': 'TEST150',
        '010-9901-1131': 'TEST151',
        '010-2617-7388': 'TEST152',
        '010-8426-9928': 'TEST153',
        '010-4812-5220': 'TEST154',
        '010-3653-1540': 'TEST155',
        '010-6557-8450': 'TEST156',
        '010-9744-1066': 'TEST157',
        '010-5606-0548': 'TEST158',
        '010-2013-2132': 'TEST159',
        '010-5195-0578': 'TEST160',
        '010-5591-3591': 'TEST161',
        '010-2029-3034': 'TEST162',
        '010-5253-8962': 'TEST163',
        '010-7658-2243': 'TEST164',
        '010-5134-4628': 'TEST165',
        '010-5760-4776': 'TEST166',
        '010-5478-9140': 'TEST167',
        '010-4939-3976': 'TEST168',
        '010-5450-7246': 'TEST169',
        '010-5712-9582': 'TEST170',
        '010-2732-3979': 'TEST171',
        '010-8939-0505': 'TEST172',
        '010-5005-8576': 'TEST173',
        '010-8565-4144': 'TEST174',
        '010-9089-4074': 'TEST175',
        '010-9600-3150': 'TEST176',
        '010-2466-0948': 'TEST177',
        '010-2085-9710': 'TEST178',
        '010-9261-5433': 'TEST179',
        '010-2062-8124': 'TEST180',
        '010-3016-0590': 'TEST181',
        '010-3222-9529': 'TEST182',
        '010-8749-8894': 'TEST183',
        '010-2107-1377': 'TEST184',
        '010-7402-6576': 'TEST185',
        '010-8250-0878': 'TEST186',
        '010-9562-7272': 'TEST187',
        '010-4107-0068': 'TEST188',
        '010-9406-9219': 'TEST189',
        '010-7144-6908': 'TEST190',
        '010-5653-4656': 'TEST191',
        '010-2412-9802': 'TEST192',
        '010-5120-1561': 'TEST193',
        '010-4843-7895': 'TEST194',
        '010-4576-8175': 'TEST195',
        '010-8916-0234': 'TEST196',
        '010-3456-1359': 'TEST197',
        '010-9668-3097': 'TEST198',
        '010-8854-0758': 'TEST199',
        '010-5171-3861': 'TEST200',
        '010-7295-8897': 'TEST201',
        '010-3692-1613': 'TEST202',
        '010-8578-4449': 'TEST203',
        '010-9187-7913': 'TEST204'
    };

    const rxCodes = ['3096578925', '6261703703', '5919777370', '3648027504', '5672271015', '9157011325', '7562077477', '3824465491', '0826343269', '0130354134',
    '2645297810', '6106507337', '1443341525', '9038122364', '7062942064', '6207741098', '4884473372', '3011770343', '9994757534', '3156632276',
    '3022639447', '6537157574', '6664124504', '8746651069', '1967178701', '9069441252', '7658910152', '0313353671', '2697436623', '2597491640',
    '4120107380', '9893122900', '4603804311', '0322803092', '4188114221', '0532790364', '5347225491', '7544543135', '2266082920', '0726711685',
    '8547059202', '3586745558', '9728596272', '1005660583', '9930652625', '6281398445', '8929871800', '3045038994', '1097458717', '8179748468',
    '5034905266', '6037122826', '8825038601', '6683621384', '6709954879', '0180631414', '0725971407', '7390544307', '5176469898', '3290931462',
    '3652327204', '8570422566', '0111228027', '1519036284', '9281571370', '2460806410', '5668652584', '2002940873', '8563864802', '2952463421',
    '3284100636', '9482645224', '7661963580', '1499443868', '4185471220', '6518129959', '4592647181', '9318055734', '4057239557', '8717852862',
    '2489549152', '6255731206', '4685081094', '0244651357', '6589833306', '8116500018', '6125306896', '8769993956', '0730440465', '5849458638',
    '4105113825', '1159211679', '7610066269', '3180678321', '7395198948', '8777811066', '1566802487', '8152842018', '9350403586', '6894640490',
    '2254661003', '5414260831', '4481917278', '9005218365', '9681326114', '8931786051', '9444701325', '0141854880', '1791628093', '1189961539',
    '0067530349', '5545995096', '7546204572', '3329407160', '5334788690', '7795568276', '2813583267', '0275966696', '6492527445', '2359136124',
    '6758281416', '1661055082', '1491799097', '3913434537', '5314755988', '1468445162', '0612976771', '2732687949', '1986271044', '1986271044',
    '2480750903', '6453654876', '2993638677', '7027473550', '8262290898', '3621377507', '4476911807', '8672689159', '6849728868', '8507329069',
    '3840800059', '0720621842', '3337835973', '8060452856', '4168037037', '5433348637', '7054823468', '2326062191', '3255860084', '1600956461',
    '0893821689', '7283739550', '7362353379', '6776227112', '7971721306', '1890412593', '4538522641', '4954227746', '5188198677', '7875412562',
    '0519905504', '8266824458', '9021002310', '3881918711', '5351810005', '4409105045', '9834644061', '1934739449', '2243410548', '1050285833',
    '8586091864', '7759500203', '6190856689', '8313498823', '5087690653', '1931366591', '0909927906', '5681053687', '3759933593', '8363032702',
    '8481145588', '5668811102', '7612934674', '4923264806', '3367923062', '0147939897', '9238967015', '2078866300', '5821260756', '1273702293',
    '9431994113', '6132039253', '9042404488', '9325061180', '7415577864', '5082049160', '0378314528', '3210181583', '3973804876', '7270881495',
    '9528007340', '6059105764', '4232356020', '6977437806'];
    
    const txCodes = ['7752443124', '5562720826', '6543449282', '1713811325', '9281684046', '9197287645', '5496477156', '3995062342', '2786427639', '2381320898',
    '5017974978', '7723266348', '0745706274', '7244649157', '0794025714', '3116919006', '6242303225', '0927120586', '7416152258', '3522471214',
    '6572789850', '4711330065', '6293560878', '4080952928', '9416593330', '6890815136', '6786816970', '6725777996', '3884593001', '4682247144',
    '1966238137', '9118078687', '4011731621', '0065331693', '5458125218', '8382776586', '3352024801', '3186580688', '7438274921', '3663194848',
    '0214255224', '8538415093', '2725618915', '5126056438', '6730754440', '5078300426', '7374468915', '0258661686', '0758456175', '6706907619',
    '0801744253', '1161730562', '3784858678', '1355836431', '0060504699', '4926386616', '0979929738', '1291880585', '9679982853', '4195487374',
    '6324776935', '5349702466', '3295572457', '2446419226', '6015922120', '3460915864', '4796642544', '1166349822', '6038939517', '1003594280',
    '5288956333', '3148885245', '5295857400', '0886986554', '1414389464', '7792018975', '3375133277', '3979416917', '5530531785', '6706774024',
    '6882111084', '6125234794', '9280740657', '2171750149', '6718683961', '5270980521', '8878187730', '0754919889', '7157888969', '8034301273',
    '6153713803', '7663390007', '5425952020', '4291303257', '3855058482', '2594669064', '0206712654', '6866964741', '7545400485', '5017974978',
    '0190819244', '0930496117', '2849978623', '3584417658', '2154683113', '4267514317', '4412286552', '6399022787', '2619407600', '6077908167',
    '0599495718', '2945645399', '7114786917', '7627181472', '5895827405', '8264671032', '9615855920', '0357130843', '7865037481', '4170365815',
    '9614698477', '2101281570', '1677137472', '4731137419', '4065091132', '9551162216', '7870754376', '0496551620', '7779001720', '3909604623',
    '3310027386', '7180895578', '2588442980', '5087773852', '6397865233', '5490438499', '3184089816', '9329230942', '7458613093', '1724492864',
    '2679774137', '2473750360', '5260772574', '2041183364', '8346809096', '8370980310', '1229365753', '3314913501', '8177199243', '0857626085',
    '9028893486', '6310942271', '4918705312', '8697255641', '2383770412', '7202708985', '8770894464', '7564035937', '1764486461', '5001803249',
    '2990178531', '2833908363', '3970284381', '7373024083', '3267028366', '9366001099', '9761072562', '6311696268', '9531772181', '6012056131',
    '9763412251', '8651860547', '8365703798', '6116129001', '6347126542', '8676901345', '5792534764', '6339636691', '4881491620', '7412943297',
    '9073911238', '0911727836', '3801443110', '2092295438', '7568708099', '2248336072', '6659646815', '8301733184', '6035630224', '4234287970',
    '9513931841', '1523390548', '0911534077', '0727151017', '3635418461', '6181813701', '6909335340', '9978462336', '5916945817', '0592494615',
    '4125208264', '6642334674', '1317995594', '6413317203'];

    function normalizePhone(phone) {
        const normalized = phone.replace(/[^0-9]/g, '');
        return normalized.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
    }

    function showMessage(message) {
        messageDiv.textContent = message;
        setTimeout(() => {
            messageDiv.textContent = '';
        }, 3000);
    }

    function searchPhone() {
        const phone = normalizePhone(phoneInput.value);
        testNumberDiv.classList.remove('visible');
        goButton.classList.remove('visible');
        
        if (!phone.startsWith('010-')) {
            showMessage('올바른 휴대폰번호를 입력해주세요');
            return;
        }

        const testKey = database[phone];
        if (testKey) {
            const testNumber = parseInt(testKey.replace('TEST', ''), 10);
            testNumberDiv.innerHTML = `테스트번호 : <span>TEST ${testNumber}</span>`;
            rxCodeInput.value = rxCodes[testNumber - 1];
            txCodeInput.value = txCodes[testNumber - 1];
            setTimeout(() => testNumberDiv.classList.add('visible'), 10);
        } else {
            testNumberDiv.textContent = '';
            rxCodeInput.value = '';
            txCodeInput.value = '';
            showMessage('등록되지 않은 테스터입니다.');
        }
    }

    searchButton.addEventListener('click', searchPhone);

    phoneInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            searchPhone();
        }
    });

    function copyToClipboard(text, button) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            button.setAttribute('data-tooltip', '접속키가 복사되었습니다');
            setTimeout(() => {
                button.setAttribute('data-tooltip', '복사할 수 있습니다');
            }, 2000);
            showGoButton();
        } catch (err) {
            console.error('복사 실패:', err);
        }
        document.body.removeChild(textArea);
    }

    function showGoButton() {
        goButton.classList.add('visible');
    }

    copyRxButton.addEventListener('click', () => {
        if (rxCodeInput.value) {
            copyToClipboard(rxCodeInput.value, copyRxButton);
        }
    });

    copyTxButton.addEventListener('click', () => {
        if (txCodeInput.value) {
            copyToClipboard(txCodeInput.value, copyTxButton);
        }
    });

    goButton.addEventListener('click', () => {
        goButton.style.transform = 'scale(0.95)';
        setTimeout(() => {
            window.location.href = 'http://13.125.255.210:8080/login';
        }, 200);
    });
});
